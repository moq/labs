<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net461</TargetFramework>
    <IncludeRoslyn>true</IncludeRoslyn>
    <IncludeMSBuild>true</IncludeMSBuild>
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
    <EnforceCopyLocalAssets>true</EnforceCopyLocalAssets>
    <PrimaryOutputKind>Build</PrimaryOutputKind>
    <PrimaryOutputFrameworkSpecific>true</PrimaryOutputFrameworkSpecific>
  </PropertyGroup>

  <ItemDefinitionGroup>
    <ProjectReference>
      <!-- This causes the output of the referenced projects to be packaged into the primary output folder too -->
      <AdditionalProperties>PrimaryOutputKind=$(PrimaryOutputKind);IncludeApi=false</AdditionalProperties>
    </ProjectReference>
    <PackageReference>
      <PrivateAssets>all</PrivateAssets>
      <Pack>false</Pack>
    </PackageReference>
  </ItemDefinitionGroup>

  <ItemGroup>
    <None Remove="Stunts.CodeFix.props" />
    <None Remove="Stunts.CodeFix.targets" />
  </ItemGroup>

  <ItemGroup>
    <Content Include="Stunts.CodeFix.props">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="Stunts.CodeFix.targets">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.CodeAnalysis.CSharp.Workspaces" Version="$(RoslynVersion)" />
    <PackageReference Include="Microsoft.CodeAnalysis.VisualBasic.Workspaces" Version="$(RoslynVersion)" />
    <PackageReference Include="Microsoft.Extensions.DependencyModel" Version="2.0.4" CopyLocal="true" />
    <PackageReference Include="StreamJsonRpc" Version="1.3.23" CopyLocal="true" />
    <PackageReference Include="Xamarin.Build.AsyncTask" Version="0.2.8" CopyLocal="true" />
    <CopyLocalPackageId Include="Microsoft.DotNet.PlatformAbstractions" />
    <CopyLocalPackageId Include="Microsoft.CodeAnalysis" />
    <CopyLocalPackageId Include="Newtonsoft.Json" />
    <CopyLocalPackageId Include="Microsoft.VisualStudio.Threading" />
    <CopyLocalPackageId Include="Microsoft.VisualStudio.Validation" />
    <CopyLocalPackageId Include="System.Threading.Tasks.Extensions" />
    <CopyLocalPackageId Include="ManagedEsent" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\Stunts.CodeFix\Stunts.CodeFix.csproj" />
  </ItemGroup>

  <ItemGroup>
    <Reference Include="Microsoft.CSharp" />
  </ItemGroup>

  <Target Name="_FixPackageFileFramework" BeforeTargets="GetPackageContents" AfterTargets="$(GetPackageContentsDependsOn)">
    <ItemGroup>
      <PackageFile>
        <TargetFrameworkMoniker>.NETStandard,Version=v1.3</TargetFrameworkMoniker>
        <FrameworkSpecific>true</FrameworkSpecific>
      </PackageFile>
    </ItemGroup>
  </Target>

  <Target Name="_RemoveSqlLiteContent" AfterTargets="ResolveAssemblyReferences">
    <ItemGroup>
      <Content Remove="@(Content)" Condition="$([MSBuild]::ValueOrDefault('%(Filename)', '').Contains('sqlite'))" />
    </ItemGroup>
  </Target>

</Project>